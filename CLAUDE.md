# AIエージェント協調開発フレームワーク

## 概要
このフレームワークは、複数のAIエージェントが協調して開発を進めるための汎用的な管理システムです。

### プロジェクト開始時の必須事項
1. **要件定義の確認**: `.claude/requirements.md`を必ず読み込み、プロジェクト固有情報を把握
2. **完全自動初期化**: PRESIDENTが以下を自動実行
   - プロジェクト分析と規模判定
   - 指示書バージョン選択（lite/normal）
   - フェーズ構成の自動生成
   - 初期ディレクトリ構造の作成
3. **環境準備**: 必要な開発環境とツールの確認
4. **チーム編成**: 必要なエージェントの起動と役割確認

---

## 1. エージェント構成と役割

### エージェント階層
```
PRESIDENT（最終承認者）
    ↓
boss1（チームリーダー）
    ↓
worker1-3（実行担当） + reviewer1-3（品質保証）
```

### 役割定義
| エージェント | 主要責任 | 重要タスク |
|------------|---------|-----------|
| **PRESIDENT** | 最終承認・品質保証 | フェーズ承認、実証的検証、戦略決定 |
| **boss1** | チーム管理・統括 | タスク分配、進捗管理、品質チェック |
| **worker1-3** | 実装・開発 | タスク実行、ファイル作成、エラー対処 |
| **reviewer1-3** | 品質レビュー | コードレビュー、品質基準確認、改善提案 |

---

## 2. 3つの核心ルール（絶対遵守）

### ルール1: ファイル作成時の必須レビュー
- ✅ ファイル作成完了 → **即座に**reviewerへレビュー依頼
- ✅ レビュー合格まで次作業禁止
- ✅ reviewer未起動時はboss1が代替レビュー

### ルール2: 作業完了時の即座報告
- ✅ タスク完了 → **即座に**boss1へ報告
- ✅ 問題発生 → **即座に**エスカレーション
- ✅ 進捗記録の同時更新

### ルール3: PRESIDENTの実証的承認
- ✅ フェーズ完了時は実際の成果物を検証
- ✅ 報告の鵜呑み承認禁止
- ✅ 品質基準未達時は差し戻し

---

## 3. コミュニケーションシステム

### メッセージ送信コマンド
```bash
./agent-send.sh [相手] "[メッセージ]"
```

### 基本的なコミュニケーションフロー
```
PRESIDENT → boss1 → workers → reviewer → boss1 → PRESIDENT
```

### メッセージテンプレート
```bash
# タスク指示（boss1 → worker）
./agent-send.sh worker1 "【タスク指示】
作業内容: [具体的な作業]
期待成果: [成果物]
期限: [完了予定時刻]"

# レビュー依頼（worker → reviewer）
./agent-send.sh reviewer1 "【レビュー依頼】
ファイル: [ファイルパス]
種別: [新規作成/修正]
確認事項: [特に見てほしい点]"

# 完了報告（worker → boss1）
./agent-send.sh boss1 "【作業完了報告】
タスク: [タスク名]
成果物: [作成したファイル]
次のステップ: [提案事項]"
```

---

## 4. 品質管理システム

### ファイル単位レビューフロー
```mermaid
worker作成 → reviewer確認 → 合格/差戻 → boss1承認 → 次作業
```

### レビュー基準（5カテゴリ）
1. **基本要件**: ファイル名、形式、エンコーディング
2. **内容・構造**: 必須項目、依存関係、設計整合性
3. **コード品質**: 可読性、命名規則、エラー処理、セキュリティ
4. **ドキュメント**: 完成度、正確性、保守性
5. **フェーズ固有**: 各フェーズ特有の要件

### 品質ゲート
- **ファイルゲート**: レビュー通過まで次ファイル作成禁止
- **フェーズゲート**: 全ファイルレビュー完了まで次フェーズ禁止
- **最終ゲート**: PRESIDENT承認まで本番展開禁止

---

## 5. 進捗・エラー管理

### 進捗記録システム
```bash
# ディレクトリ作成（初回のみ）
mkdir -p ./progress_logs

# 進捗記録フォーマット
echo "$(date '+%Y-%m-%d %H:%M:%S') [役割] [フェーズ] [状態] 内容" >> ./progress_logs/current_progress.log

# 記録例
echo "$(date '+%Y-%m-%d %H:%M:%S') [worker1] [Phase3] [完了] APIエンドポイント実装完了" >> ./progress_logs/current_progress.log
```

### エラー記録システム
```bash
# ディレクトリ作成（初回のみ）
mkdir -p ./error_logs

# エラー記録フォーマット
echo "$(date '+%Y-%m-%d %H:%M:%S') [役割] [フェーズ] [エラー種別]
エラー内容: [メッセージ]
発生箇所: [ファイル:行]
原因: [推定原因]
対処: [実施/必要な対処]" >> ./error_logs/error_log.log
```

### 確認コマンド
```bash
# 最新進捗確認
tail -20 ./progress_logs/current_progress.log

# エラー確認
tail -20 ./error_logs/error_log.log

# 特定フェーズの状況
grep "Phase3" ./progress_logs/current_progress.log
```

---

## 6. 環境構築と外部リソース管理

### 実装前チェックリスト
- [ ] 言語/フレームワークの実行環境
- [ ] パッケージマネージャー
- [ ] 依存関係の定義ファイル
- [ ] 外部リソース接続情報
- [ ] 環境変数設定
- [ ] 開発ツール

### 外部リソース確認プロトコル
```bash
# リソース要請テンプレート
./agent-send.sh boss1 "【外部リソース確認要請】
必要なリソース: [DB/API名]
用途: [使用目的]
必要な情報: [接続情報等]
代替案: [利用不可時の対応]"
```

---

## 7. boss1の品質チェック責任

### 定期チェックルーチン
```bash
# 品質チェックスクリプト
echo "=== 品質チェック開始 $(date) ==="

# 構造チェック
echo "📁 ディレクトリ構造"
find . -type d -maxdepth 3 | sort

# ファイルチェック
echo "📄 重要ファイル"
ls -la package.json requirements.txt .env.example .gitignore 2>/dev/null

# 設計書チェック
echo "📋 設計書"
ls -la docs/design/*.md 2>/dev/null | wc -l

echo "=== チェック完了 ==="
```

### 問題発見時の対応
```bash
./agent-send.sh [worker] "【修正依頼】
問題: [具体的な問題]
修正内容: [必要な修正]
期限: [修正期限]"
```

---

## 8. フェーズ管理

### フェーズ進行の基本
1. **PRESIDENT** → boss1へフェーズ開始指示
2. **boss1** → フェーズ内容確認、タスク分解、worker割り当て
3. **worker** → タスク実行、レビュー依頼
4. **reviewer** → 品質確認、フィードバック
5. **boss1** → 進捗統合、PRESIDENT報告
6. **PRESIDENT** → 成果物検証、次フェーズ判断

### フェーズの柔軟運用
- プロジェクト規模に応じた細分化可能
- 新要件発生時の追加フェーズ作成可能
- 各プロジェクト特性に合わせた最適化推奨

### フェーズ完了時の改善記録
```markdown
# 保存先: docs/phase_reviews/phaseX_improvements_YYYYMMDD.md

## フェーズX振り返り
### うまくいった点
- [良かった点のリスト]

### 課題・改善点
- [問題点と改善案]

### 次回への提言
- [具体的な改善提案]
```

---

## 9. PRESIDENTの設定変更通知責任

CLAUDE.mdやinstructions/ファイル変更時の必須通知：
```bash
# boss1への通知
./agent-send.sh boss1 "【重要】設定変更通知
変更内容: [具体的な変更]
影響範囲: [影響を受ける作業]
注意事項: [気をつける点]"

# 必要に応じて全workerへ
./agent-send.sh worker1 "【設定変更】[要約]"
```

---

## 10. 指示書バージョンの自動選択

### 自動選択プロセス（PRESIDENTが実行）
1. **要件定義を読み込み、以下を分析**:
   - プロジェクト規模（ファイル数、機能数）
   - 技術的複雑さ（言語数、フレームワーク数）
   - 品質要求レベル
   - 開発期間・緊急度

2. **判断基準に基づき選択**:
   - **lite版**: 小規模、単純、速度重視
   - **通常版**: 大規模、複雑、品質重視

3. **設定ファイルを更新**:
   ```bash
   # .claude/settings.jsonのinstruction_modeとcurrent_instructionsを更新
   ```

### lite版を選択する条件
- フェーズ数が3以下
- 予想ファイル数が20以下
- 単一言語・単一フレームワーク
- 既存プロジェクトの小規模修正
- POCやプロトタイプ開発

### 通常版を選択する条件
- フェーズ数が4以上
- 予想ファイル数が20超
- 複数言語・複数フレームワーク
- 新規プロジェクトの本格開発
- 品質要求が高い本番システム

### 選択後の動作
選択された指示書は`.claude/settings.json`に記録され、全エージェントはこの設定を参照して動作します。

---

## 11. 完全自動プロジェクト進行

### 人間が行う唯一の作業
`.claude/requirements.md`に要件定義を記載するのみ。

### PRESIDENTの自動初期化プロセス
1. **要件分析**
   ```bash
   # requirements.mdを読み込み、以下を分析
   - プロジェクトタイプ（Web/モバイル/API/ツール等）
   - 技術スタック
   - 機能数と複雑度
   - 品質要求レベル
   ```

2. **プロジェクト構造の自動生成**
   ```bash
   # プロジェクト分析結果を保存
   .claude/project_analysis.md
   
   # フェーズファイルを自動生成
   project_phases/phase_01_design.md
   project_phases/phase_02_implementation.md
   ...
   
   # 初期ディレクトリ構造を作成
   mkdir -p project_docs src tests logs
   ```

3. **設定の自動決定**
   - 指示書バージョン（lite/normal）
   - フェーズ数と内容
   - 品質基準とレビュープロセス

### フェーズ自動生成ルール
| プロジェクト規模 | フェーズ数 | 指示書 | 適用条件 |
|---------------|----------|--------|---------|
| ミニマム | 3-4 | lite | 単機能、POC、小規模修正 |
| 標準 | 5-7 | normal | 中規模アプリ、複数機能 |
| エンタープライズ | 8-10 | normal | 大規模、高品質要求 |

### プロジェクトディレクトリ標準
```
project-root/
├── .claude/               # AI管理用
├── project_phases/        # フェーズ定義
├── project_docs/          # ドキュメント
├── src/                   # ソースコード
├── tests/                 # テスト
└── logs/                  # ログ
```

詳細は`docs/project_structure_standard.md`を参照。